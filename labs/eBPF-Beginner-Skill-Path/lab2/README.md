# Lab 2 — eBPF hash map counter (`exec_count`)

Implements the iximiuz “Storing Data in eBPF: Your First eBPF Map” tutorial. Tracks how many times each binary path is executed using a hash map updated in the kernel program.

Tutorial reference: https://labs.iximiuz.com/tutorials/ebpf-maps-tutorial-3efd4617

## Files
- `hello.c` — kernel program with `exec_count` hash map; updates per-path counters and logs via `bpf_printk`.
- `main.go` — user-space loader that generates/loads the BPF object and attaches to tracepoint `sys_enter_execve`.
- `go.mod` — module definition.
- `vmlinux.h` — generated header (not committed; see below).
- `hello_bpf.*` — generated by `bpf2go` (not committed; see build steps).

## Prereqs
- Go >= 1.22
- `clang` / `llc`
- `bpftool`
- Kernel with BTF (`/sys/kernel/btf/vmlinux`)

## One-time: generate `vmlinux.h`
```bash
bpftool btf dump file /sys/kernel/btf/vmlinux format c > vmlinux.h
```

## Build
```bash
# from labs/eBPF-Beginner-Skill-Path/lab2
go generate ./...   # runs bpf2go to compile hello.c
go build ./...      # produces ./lab2 binary
```

## Run & observe
```bash
sudo ./lab2
```

In another terminal, watch printk:
```bash
sudo cat /sys/kernel/debug/tracing/trace_pipe
```

Trigger executions (e.g., `uname -a`, `ls`) and you should see `execve: <path>` messages.

## Inspect the map with bpftool
```bash
sudo bpftool map list              # find the ID for exec_count
sudo bpftool map dump id <ID>      # dump keys/values (path -> count)
```

## Cleanup
```bash
sudo pkill lab2 || true
```

