# Lab 3 — Inspecting & Monitoring with bpftool/bpftop

Implements the iximiuz tutorial “Inspecting and Monitoring eBPF Applications” (<https://labs.iximiuz.com/tutorials/inspecting-ebpf-using-bpftool-43dfa319>). The code is the same execve-path counter from lab2; this lab focuses on inspecting it with bpftool and monitoring with bpftop.

## Files
- `hello.c` — kernel program with the `exec_count` hash map.
- `main.go` — user-space loader attaching to `sys_enter_execve`.
- `go.mod` — module definition.
- `vmlinux.h` — generated header (not committed; see below).
- `hello_bpf.*` — generated by `bpf2go` (not committed).

## Prereqs
- Go >= 1.22
- `clang` / `llc`
- `bpftool` and `bpftop`
- Kernel with BTF (`/sys/kernel/btf/vmlinux`)

## One-time: generate `vmlinux.h`
```bash
bpftool btf dump file /sys/kernel/btf/vmlinux format c > vmlinux.h
```

## Build
```bash
go generate ./...   # runs bpf2go to compile hello.c
go build ./...      # produces ./lab3 binary
```

## Run & inspect
```bash
sudo ./lab3
```

In another terminal:
```bash
sudo cat /sys/kernel/debug/tracing/trace_pipe       # see printk events
sudo bpftool prog list                               # find the program ID
sudo bpftool map list                                # find the exec_count map ID
sudo bpftool map dump id <ID>                        # view per-path counters
sudo bpftop                                          # monitor runtime stats
```

## Cleanup
```bash
sudo pkill lab3 || true
```

